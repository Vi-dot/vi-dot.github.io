{"version":3,"file":"pdf-viewer.component.js","sourceRoot":"","sources":["../../src/pdf-viewer/pdf-viewer.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by vadimdez on 21/06/16.\n */\nimport {\n  Component, Input, Output, ElementRef, EventEmitter, OnInit\n} from '@angular/core';\nimport 'pdfjs-dist/build/pdf.combined';\nimport 'pdfjs-dist/web/pdf_viewer';\n\n@Component({\n  selector: 'pdf-viewer',\n  template: `<div class=\"ng2-pdf-viewer-container\"><div id=\"viewer\" class=\"pdfViewer\"></div></div>`,\n  styles: [`\n.ng2-pdf-viewer--zoom {\n  overflow-x: scroll;\n}\n\n:host >>> .ng2-pdf-viewer-container > div {\n  position: relative;\n}\n\n:host >>> .textLayer {\n  position: absolute;\n  margin-left: auto;\n  margin-right: auto;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  color: #000;\n  font-family: sans-serif;\n  overflow: hidden;\n}\n  `]\n})\n\nexport class PdfViewerComponent extends OnInit {\n  private static CSS_UNITS: number = 96.0 / 72.0;\n\n  private _showAll: boolean = true; // TODO : _showAll is not working\n  private _renderText: boolean = true;\n  private _renderLink: boolean = true;\n  private _stickToPage: boolean = false;\n  private _originalSize: boolean = true;\n  private _src: any;\n  private _pdf: any;\n  private _page: number = 1;\n  private _zoom: number = 1;\n  private wasInvalidPage: boolean = false;\n  private _rotation: number = 0;\n  private isInitialised: boolean = false;\n  private lastLoaded: string;\n  private _enhanceTextSelection: boolean = false;\n  private _pageBorder: boolean = false;\n  private _pdfViewer: any;\n  private _pdfLinkService: any;\n  @Input('after-load-complete') afterLoadComplete: Function;\n\n  constructor(private element: ElementRef) {\n    super();\n  }\n\n  ngOnInit() {\n    this.setupViewer();\n    this.isInitialised = true;\n  }\n\n  @Input('src')\n  set src(_src) {\n    this._src = _src;\n\n    if (this.isInitialised) {\n      this.loadPDF();\n    }\n  }\n\n  @Input('page')\n  set page(_page) {\n    _page = parseInt(_page, 10);\n\n    if (!this._pdf) {\n      this._page = _page;\n      return;\n    }\n\n    if (this.isValidPageNumber(_page)) {\n      this._page = _page;\n      this.render();\n      this.wasInvalidPage = false;\n    } else if (isNaN(_page)) {\n      this.pageChange.emit(null);\n    } else if (!this.wasInvalidPage) {\n      this.wasInvalidPage = true;\n      this.pageChange.emit(this._page);\n    }\n  }\n\n  @Output() pageChange: EventEmitter<number> = new EventEmitter<number>(true);\n\n  @Input('render-text')\n  set renderText(renderText) {\n    this._renderText = renderText;\n    if (this._pdf) {\n      this.setupViewer();\n    }\n  }\n\n  @Input('render-link')\n  set renderLink(renderLink) {\n    this._renderLink = renderLink;\n    if (this._pdf) {\n      this.setupViewer();\n    }\n  }\n\n  @Input('original-size')\n  set originalSize(originalSize: boolean) {\n    this._originalSize = originalSize;\n\n    if (this._pdf) {\n      this.updateSize();\n    }\n  }\n\n  @Input('show-all')\n  set showAll(value: boolean) {\n    this._showAll = value;\n\n    if (this._pdf) {\n      this.render();\n    }\n  }\n\n  @Input('stick-to-page')\n  set stickToPage(value: boolean) {\n    this._stickToPage = value;\n\n    if (this._pdf) {\n      this.render();\n    }\n  }\n\n  @Input('zoom')\n  set zoom(value: number) {\n    if (value <= 0) {\n      return;\n    }\n\n    this._zoom = value;\n\n    if (this._pdf) {\n      this.updateSize();\n    }\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  @Input('rotation')\n  set rotation(value: number) {\n    if (!(typeof value === 'number' && value % 90 === 0)) {\n      console.warn('Invalid pages rotation angle.');\n      return;\n    }\n\n    this._rotation = value;\n\n    if (this._pdf) {\n      this.render();\n    }\n  }\n\n  @Input('page-border')\n  set pageBorder(value: boolean) {\n    this._pageBorder = value;\n    if (this._pdf) {\n      this.setupViewer();\n    }\n  }\n\n  @Input('enhance-text-selection')\n  set enhanceTextSelection(value: boolean) {\n    this._enhanceTextSelection = value;\n    if (this._pdf) {\n      this.setupViewer();\n    }\n  }\n\n  public setupViewer() {\n\n    PDFJS.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';\n    //PDFJS.disableWorker = true;\n\n    PDFJS.disableTextLayer = !this._renderText;\n\n    let container = this.element.nativeElement.querySelector('div');\n\n    var pdfOptions = {\n      container: container\n    };\n\n    if (this._renderLink) {\n      this._pdfLinkService = new PDFJS.PDFLinkService();\n      pdfOptions['linkService'] = this._pdfLinkService;\n    }\n\n    if (!this._pageBorder) {\n      pdfOptions['removePageBorders'] = true;\n    }\n\n    if (this._enhanceTextSelection) {\n      pdfOptions['enhanceTextSelection'] = this._enhanceTextSelection;\n    }\n\n    this._pdfViewer = new PDFJS.PDFViewer({\n      container: container\n    });\n\n    if (this._renderLink) {\n      this._pdfLinkService.setViewer(this._pdfViewer);\n    }\n\n    if (this._src) {\n      this.loadPDF();\n    }\n  }\n\n  public loadPDF(src?) {\n\n    if (!src) {\n      src = this._src;\n    }\n\n    if (src) {\n\n      PDFJS.getDocument(src).then((pdf: PDFDocumentProxy) => {\n\n        this._pdf = pdf;\n        this.lastLoaded = src;\n\n        if (this.afterLoadComplete && typeof this.afterLoadComplete === 'function') {\n          this.afterLoadComplete(pdf);\n        }\n\n        this._pdfViewer.setDocument(this._pdf);\n        this._pdfLinkService.setDocument(this._pdf, null);\n\n        this.render();\n      });\n    }\n  }\n\n  public render() {\n    if (!this.isValidPageNumber(this._page)) {\n      this._page = 1;\n    }\n\n    if (this._rotation !== 0 || this._pdfViewer.pagesRotation !== this._rotation) {\n      this._pdfViewer.pagesRotation = this._rotation;\n    }\n\n    if (this._stickToPage) {\n      this._pdfViewer.currentPageNumber = this._page;\n    }\n\n    this.updateSize();\n  }\n\n  public updateSize() {\n    if (!this._originalSize) {\n      this._pdf.getPage(this._pdfViewer._currentPageNumber).then((page: PDFPageProxy) => {\n        let scale = this._zoom * (this.element.nativeElement.offsetWidth / page.getViewport(1).width) / PdfViewerComponent.CSS_UNITS;\n        this._pdfViewer._setScale(scale, !this._stickToPage);\n      });\n    } else {\n      this._pdfViewer._setScale(this._zoom, !this._stickToPage);\n    }\n  }\n\n  public isValidPageNumber(page: number) {\n    return this._pdf.numPages >= page && page >= 1;\n  }\n}\n"]}